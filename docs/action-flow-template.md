Инструкция-шаблон, как правильно фиксировать **action flow** для любого бизнес- или системного действия в приложении:

---

# **Action Flow — инструкция и шаблон для проектирования потоков**

---

## **1. Что такое action flow и как он выглядит**

**Action flow (иногда также request flow, feature flow, user flow)** — это чётко прописанный маршрут выполнения одного действия в системе:
**от точки входа (контроллер) до всех задействованных слоёв, модулей и адаптеров, с возвратом результата клиенту.**

Action flow всегда оформляется пошагово, по слоям архитектуры.

### **Action flow — шаблон:**

```
<Название потока (краткое описание задачи, роли и канала)>

1. <Controller/Handler>::<action>($request)
2. → <Service>::<method>(...)
3. → <Domain Entity/ValueObject> (создаётся/изменяется)
4. → <Repository>::<method>(...)
5. → (по необходимости) <Integration/Adapter>::<method>(...)
6. ← результат возвращается в Controller и клиенту
```

**Можно и нужно указывать роль/канал:**

```
Пользователь (Bot) -> Controller -> Service -> Domain -> Repository -> Infrastructure
```

или

```
Админ (Web) -> AdminController -> AdminService -> Domain (OperationLog) -> AdminStatsRepository -> Logger
```

---

## **2. Как группировать action flows**

* **Оптимально — по модулям (фичам, бизнес-действиям), а внутри модуля — по слоям.**

    * Примеры модулей:

        * **Питание:** Добавление еды, история, удаление
        * **Цели:** Установка, просмотр, обновление целей
        * **Оплата:** Активация PRO, продление подписки
        * **Админка:** Просмотр статистики, сброс лимита, аудит

* **В каждом action flow показывай движение по архитектурным слоям:**

    * Controller → Service → Domain → Repository → Infrastructure (по необходимости)

---

## **3. Когда составлять action flows — до или после проектирования классов/интерфейсов?**

**Best Practice (современный подход):**

1. **Сначала** описываются action flows для всех ключевых действий (и пользовательских, и административных, и фоновых).
2. **Затем** на их основе проектируются интерфейсы, классы, методы.

    * То есть: action flow → сигнатуры методов и интерфейсов → реализация.

**Зачем так?**

* Сразу понятно, какие методы и интерфейсы реально нужны, и как их связать.
* Исключаются дубли, хаос, лишний код и пересечения логики.
* Быстро выявляются ошибки и edge-case.

---

## **4. Примеры action flow для проектирования**

### *\[Модуль "Питание" — Добавление еды по фото (Bot)]*

```
1. MealController::addPhoto($request)
2. → MealService::addByPhoto($userId, $photo)
3. → AIService::analyzeFoodPhoto($photo)
4. → Meal (создание сущности)
5. → MealRepository::save($meal)
6. → NotificationService::sendAddMealNotification($userId)
7. ← результат возвращается пользователю (Bot/Web/WebApp)
```

### *\[Модуль "Админ" — Сброс лимита загрузок (AdminPanel)]*

```
1. AdminController::resetUserLimit($userId)
2. → AdminService::resetUserLimit($userId)
3. → AdminStatsRepository::resetUserLimit($userId)
4. → AuditLogger::log(action, adminId, params)
5. ← результат возвращается в админку
```

---

## **5. Практические рекомендации**

* Показывай **реальный маршрут** запроса — все шаги, даже если “под капотом” ещё один вызов.
* Для сложных фич/ролей — делай отдельный action flow.
* Обозначай условия/варианты (например: “если лимит превышен — ошибка”).
* Для возврата результата всегда указывай стрелку **“←”**.
* Все action flows должны быть легко сопоставимы с будущей реализацией классов и методов.

---

## **ИТОГ**

* **Action flow — делается до проектирования интерфейсов и классов.**
* По action flow формируются классы, интерфейсы и их методы.
* Группируй action flows по бизнес-модулям и показывай движение по слоям.

---

**Используй этот шаблон для любого действия в приложении — от пользовательских до системных!**
